const e=document.querySelector("#visit-modal"),t=document.querySelector("#modal-btn"),n=document.querySelector(".close"),l=document.querySelector(".modal-footer button"),o=document.querySelector(".main-block"),i=document.querySelector(".clearAll");let s,c=0,d=0;const r=document.getElementById("list-of-doctors"),a=document.getElementById("form-inputs");function h(){e.style.display="none"}document.addEventListener("DOMContentLoaded",function(){let e,t;t=null===localStorage.getItem("positions")?[]:JSON.parse(localStorage.getItem("positions"));e=null===localStorage.getItem("cards")?[]:JSON.parse(localStorage.getItem("cards"));e.forEach(function(e){const n=document.createElement("ul");if(null!=e){null!=t[c]?n.style.top=`${t[c][0]}`:n.style.top=0,void 0!==t[c]?n.style.left=`${t[c][1]}`:n.style.left=0,n.setAttribute("id",`${c++}`),n.classList.add("created-elements"),o.appendChild(n);for(let[t,l]of Object.entries(e.slice(0,-2))){const e=document.createElement("li");e.innerHTML=`${l}`,n.appendChild(e)}let l=n.children;l[2].style.display="block",l[l.length-1].style.display="block";const i=S();n.appendChild(i);const s=v();n.appendChild(s),n.style.display="flex"}}),o.children.length>=3&&(document.querySelector(".main-block span").style.display="none");document.querySelectorAll(".created-elements").length&&document.querySelectorAll(".created-elements").forEach(e=>{!function(e){let t=e;function n(e){let n=t.getBoundingClientRect(),l=o.getBoundingClientRect();console.log(l),e.screenY<2*l.y-n.height/6?(t.style.top,l.y):e.screenY>l.y+l.width-n.height/2?(t.style.top,l.y,l.widt,n.height):t.style.top=e.clientY-l.top-n.height/2-70+"px",e.screenX<l.x+n.width/2?(t.style.left,l.x):e.screenX>l.x+l.width-n.width/2?(t.style.left,l.x,l.width,n.width):t.style.left=e.clientX-l.left-n.width/2-35+"px"}t.getBoundingClientRect(),o.getBoundingClientRect(),t.onmousedown=function(e){t.style.position="absolute",n(e),o.appendChild(t),t.style.zIndex=1e3,document.onmousemove=function(e){n(e)},t.onmouseup=function(){!function(e){let t;t=null===localStorage.getItem("positions")?[]:JSON.parse(localStorage.getItem("positions"));const n=[];n.push(e.style.top),n.push(e.style.left),t.splice(e.id,1,n),localStorage.setItem("positions",JSON.stringify(t))}(t),document.onmousemove=null}}}(e)})}),t.addEventListener("click",function(){e.style.display="block"}),n.addEventListener("click",h),window.addEventListener("click",function(t){t.target==e&&(e.style.display="none")}),l.addEventListener("click",function(){let e=a.children[d];if(o.children.length<11)for(let t=0;t<e.children.length;t++)if(""!=e.children[t].value&&null!=e.children[t].value){if(t==e.children.length-2)return y()}else e.children[t].classList.add("eror-msg");else l.disabled="true"}),i.addEventListener("click",function(){localStorage.removeItem("cards"),localStorage.removeItem("positions"),document.location.reload(!0)});class u{constructor(e,t,n){this.target=e,this.date=t,this.fullName=n}addCard(){const e=document.createElement("ul");e.setAttribute("id",`${c++}`),e.classList.add("created-elements"),o.appendChild(e);for(let[t,n]of Object.entries(this)){const l=document.createElement("li");l.innerHTML=`${t}: ${n}`,e.appendChild(l)}let t=e.children;t[2].style.display="block",t[t.length-1].style.display="block";const n=S();e.appendChild(n);const l=v();e.appendChild(l),e.style.display="flex",function(e){let t;t=null===localStorage.getItem("cards")?[]:JSON.parse(localStorage.getItem("cards"));const n=[];for(let t=0;t<e.length;t++)n.push(e[t].textContent);t.push(n),localStorage.setItem("cards",JSON.stringify(t))}(e.children)}}class p extends u{constructor(e,t,n,l,o,i,s){super(e,t,n),this.pressure=l,this.iWeight=o,this.diseases=i,this.age=s,this.position="Cardiologist",this.id=0}}class m extends u{constructor(e,t,n,l){super(e,t,n),this.dateLastVist=l,this.position="Dentist",this.id=1}}class g extends u{constructor(e,t,n,l){super(e,t,n),this.age=l,this.position="Therapist",this.id=2}}function y(){const e=[];let t="";for(let n=0;n<a.children.length;n++)if("block"==a.children[n].style.display){for(let t=0;t<a.children[n].children.length;t++)e.push(a.children[n].children[t].value);t=0===d?new p(...e):1===d?new m(...e):new g(...e),Object.defineProperty(t,"id",{enumerable:!1}),t.addCard(),h(),document.querySelector(".main-block span").style.display="none",f()}}function f(){for(let e=0;e<a.children[d].children.length;e++)a.children[d].children[e].value="",a.children[d].children[e].classList.remove("eror-msg")}function S(){return(s=document.createElement("p")).setAttribute("id","show-more"),s.innerText="Show More",s.addEventListener("mousedown",b),s}function b(e){const t=e.path[1].children;for(let e=0;e<t.length;e++)t[e].style.display="block";e.path[1].removeChild(e.target)}function v(){return btnDelete=document.createElement("div"),btnDelete.setAttribute("id","delete-visit"),btnDelete.innerText="",btnDelete.addEventListener("click",C),btnDelete}function C(e){e.path[1].style.display="none";const t=JSON.parse(localStorage.getItem("cards")),n=[];for(let t=0;t<e.path[1].children.length;t++)n.push(e.path[1].children[t].textContent);delete t[e.path[1].id],localStorage.setItem("cards",JSON.stringify(t));const l=JSON.parse(localStorage.getItem("positions")),o=[];for(let t=0;t<e.path[1].children.length;t++)o.push(e.path[1].children[t].textContent);delete l[e.path[1].id],localStorage.setItem("positions",JSON.stringify(l)),document.location.reload(!0)}r.addEventListener("change",function(e){a.children[d].style.display="none";const t=Array.from(r.children),n=t.filter(t=>t.value===e.target.value);d=t.indexOf(n[0])-1,a.children[d].style.display="block"});